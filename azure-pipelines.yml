# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master

jobs:
- job: build
  displayName: "Test"

  pool:
    vmImage: ubuntu-16.04
  
  variables:
    JAVA_TOOL_OPTIONS: "-Xmx1024m -XX:+AggressiveOpts -XX:+UseG1GC"

  steps:
  - task: Maven@3
    displayName: "Maven: Setup"
    inputs:
      mavenPomFile: "pom.xml"
      javaHomeOption: "JDKVersion"
      jdkVersionOption: "1.8"
      jdkArchitectureOption: "x64"
      publishJUnitResults: false
      goals: "dependency:resolve-plugins dependency:go-offline"
  
  - task: Maven@3
    displayName: "Maven: Build"
    inputs:
      mavenPomFile: "pom.xml"
      javaHomeOption: "JDKVersion"
      jdkVersionOption: "1.8"
      jdkArchitectureOption: "x64"
      publishJUnitResults: true
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      goals: "package source:jar javadoc:jar"

  - task: PublishPipelineArtifact@0
    displayName: "Artifact: Glowstone"
    inputs:
      artifactName: 'Glowstone'
      targetPath: 'target/glowstone.jar'

  - task: PublishPipelineArtifact@0
    displayName: "Artifact: JavaDoc JAR"
    inputs:
      artifactName: 'JavaDoc JAR'
      targetPath: 'target/glowstone-javadoc.jar'

  - task: PublishPipelineArtifact@0
    displayName: "Artifact: Sources JAR"
    inputs:
      artifactName: 'Sources JAR'
      targetPath: 'target/glowstone-sources.jar'
